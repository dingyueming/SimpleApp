
@{
    ViewData["Title"] = ViewData["Title"] ?? "实时监控";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Version"] = "20200518";
}
@section style{
    <!--ztree-->
    <link rel="stylesheet" href="~/lib/ztree/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <style>
        .toolbar {
            position: absolute;
            top: 20px;
            right: 20px;
            /*height: 35px;*/
            /*box-shadow: 0 1px 5px rgba(0,0,0,.4);
            background: #fff;*/
        }

        .el-row {
            margin: 5px;
        }

        .el-col {
            padding-right: 5px;
        }
    </style>
}

@section script{
    <!--引入高德地图JSAPI -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=07daf7aebe56f6b49516fa87628a06e4"></script>
    <!--引入UI组件库（1.1版本） -->
    <script src="//webapi.amap.com/ui/1.1/main.js"></script>
    <!--引入本地地图工具 -->
    <script src="~/plugins/amap/js/mapTools.js"></script>
    <!--SignalR-->
    <script src="~/lib/signalr/dist/browser/signalr.js"></script>
    <!--ztree-->
    <script type="text/javascript" src="~/lib/ztree/js/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="~/lib/ztree/js/jquery.ztree.exhide.js"></script>
    <script type="text/javascript" src="~/lib/ztree/js/jquery.ztree.excheck.js"></script>
    <script type="text/javascript" src="~/lib/ztree/js/jquery.ztree.exedit.js"></script>
    <script type="text/javascript" src="~/lib/ztree/demo/js/fuzzysearch.js"></script>
}
<div id="vmContent">
    <div class="row">
        <div class="col-md-2" v-show="!isFullScreen" style="padding:0px 0px 0px 5px;">
            <div class="box box-primary">
                <div class="box-body  no-padding" style="position:relative;">
                    <div class="pad">
                        <input type="text" id="key" value="" style="width:80%;height:30px" class="empty" placeholder="请输入关键字" />
                        <el-popover placement="bottom-end"
                                    width="auto"
                                    trigger="click">
                            <el-row>
                                <el-col :span="12"><el-button size="mini" icon="el-icon-location" v-on:click="locationQuery">位置查询</el-button></el-col>
                                <el-col :span="12"><el-button size="mini" icon="el-icon-s-shop" v-on:click="setReturnInterval">设置回传间隔</el-button></el-col>
                            </el-row>
                            <el-row>
                                <el-col :span="12"><el-button size="mini" icon="el-icon-s-comment" v-on:click="xfdbwen">发送报文</el-button></el-col>

                            </el-row>
                            <el-button slot="reference" icon="el-icon-platform-eleme" size="mini"></el-button>
                        </el-popover>
                        <ul id="treeDemo" class="ztree" style="border: 0px;height: 458px;width: 100%;margin-top: 3px;overflow: auto;"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div :class="!isFullScreen?fullScreenStyle.colmd10:fullScreenStyle.colmd12" style="padding:0px 5px 0px 5px;">
            <div class="box box-success">
                <div class="box-body no-padding">
                    <div class="pad no-padding" style="position:relative;">
                        <!-- Map will be created here -->
                        <!-- 提供地图容器，其中地图容器必须提供id号，用于生成地图 -->
                        <div id="container" :style="{height:(isFullScreen?fullScreenStyle.fullHeight+'px':fullScreenStyle.normalHeight+'px')}"></div>
                        <div class="toolbar">
                            <el-popover placement="left-start"
                                        width="auto"
                                        trigger="click">
                                <el-row>
                                    <el-col :span="12">@*<el-button size="mini" icon="el-icon-location" v-on:click="locationQuery">位置查询</el-button>*@</el-col>
                                    <el-col :span="12"><el-button size="mini" icon="el-icon-s-shop" v-on:click="switchUnit">重点单位</el-button></el-col>
                                </el-row>
                                <el-row>
                                    <el-col :span="12"><el-button size="mini" icon="el-icon-s-flag" v-on:click="drawRectangle(1)">执勤力量</el-button></el-col>
                                </el-row>
                                <el-row>
                                    <el-col :span="12"><el-button size="mini" icon="el-icon-s-open" v-on:click="drawRectangle(2)">消火栓&nbsp;&nbsp;&nbsp;&nbsp;</el-button></el-col>
                                </el-row>
                                <el-row>
                                    <el-col :span="12"><el-button size="mini" icon="el-icon-s-comment" v-on:click="xfdhd">&nbsp;下发导航点&nbsp;</el-button></el-col>
                                </el-row>
                                <el-button slot="reference" icon="el-icon-platform-eleme" size="mini"></el-button>
                            </el-popover>
                            <el-button icon="el-icon-full-screen" size="mini" v-on:click="isFullScreen=!isFullScreen"></el-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" v-show="!isFullScreen">
        <div class="col-md-12" style="margin-top:-15px;padding:0px 5px 0px 5px;">
            <div class="nav-tabs-custom" style="margin-bottom:0px;">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">定位信息</a></li>
                    @*<li><a href="#tab_2" data-toggle="tab">报警信息</a></li>*@
                    <li><a href="#tab_3" data-toggle="tab">短报文</a></li>
                    <li class="pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            @*<i class="fa fa-minus"></i>*@
                        </button>
                    </li>
                </ul>
                <div class="tab-content" style="overflow:auto; height:245px;">
                    <div class="tab-pane active" id="tab_1">
                        <table class="table table-hover">
                            <tr>
                                @*<th>序号</th>*@
                                <th>车牌号</th>
                                <th>识别码</th>
                                <th>SIM卡</th>
                                <th>定位时间</th>
                                <th>接收时间</th>
                                <th>速度</th>
                                <th>定位</th>
                                <th>方向</th>
                                <th>状态</th>
                                <th>定位模式</th>
                                <th>累计里程</th>
                                @*<th>位置</th>*@
                                <th>经度</th>
                                <th>纬度</th>
                            </tr>
                            <tr v-for="(newtrack,index) in gpsDatas" v-on:dblclick="dbclickLocationTable(newtrack.mac)">
                                <td>{{newtrack.license}}</td>
                                <td>{{newtrack.mac}}</td>
                                <td>{{newtrack.sim}}</td>
                                <td>{{newtrack.gnsstime}}</td>
                                <td>{{newtrack.receive_time}}</td>
                                <td>{{newtrack.speed}}</td>
                                <td>{{newtrack.locate_str}}</td>
                                <td>{{newtrack.heading_str}}</td>
                                <td>{{newtrack.status}}</td>
                                <td>{{newtrack.locatemode_str}}</td>
                                <td>{{newtrack.mileage}}</td>
                                <td>{{newtrack.longitude}}</td>
                                <td>{{newtrack.latitude}}</td>
                            </tr>
                        </table>
                    </div>
                    <!-- /.tab-pane -->
                    <div class="tab-pane" id="tab_2">
                        <table class="table table-hover">
                            <tr>
                                <th>车牌号</th>
                                <th>识别码</th>
                                <th>SIM卡</th>
                                <th>报警时间</th>
                                <th>报警信息</th>
                                <th>速度</th>
                                <th>方向</th>
                                <th>定位状态</th>
                                <th>定位</th>
                                <th>定位模式</th>
                            </tr>
                            <tr v-for="(alarmData,index) in alarmDatas" v-on:dblclick="dbclickLocationTable(alarmData.mac)">
                                <td>{{alarmData.license}}</td>
                                <td>{{alarmData.mac}}</td>
                                <td>{{alarmData.sim}}</td>
                                <td>{{alarmData.gnsstime}}</td>
                                <td>{{alarmData.alarmtype}}</td>
                                <td>{{alarmData.speed}}</td>
                                <td>{{alarmData.heading_str}}</td>
                                <td>{{alarmData.status}}</td>
                                <td>{{alarmData.locate_str}}</td>
                                <td>{{alarmData.locatemode_str}}</td>
                            </tr>
                        </table>
                    </div>
                    <!-- /.tab-pane -->
                    <div class="tab-pane" id="tab_3">
                        <table class="table table-condensed">
                            <tr>
                                <th>序号</th>
                                <th>内容</th>
                                @*<th>时间</th>*@
                            </tr>
                            <tr v-for="(msgData,index) in  msgDatas">
                                <th>{{index}}</th>
                                <th>{{msgData.msg}}</th>
                                @*<th>时间</th>*@
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">
                        下发导航点
                    </h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" role="form" id="myForm">
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="jwd">经度</label>
                            <div class="col-sm-4">
                                <input class="form-control" id="longitude" name="longitude" v-model="dhd.longitude" type="text" placeholder="经度" />
                            </div>
                            <label class="col-sm-2 control-label" for="jwd">纬度</label>
                            <div class="col-sm-4">
                                <input class="form-control" id="laitude" name="laitude" v-model="dhd.laitude" type="text" placeholder="经度" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="path">路径选择</label>
                            <div class="col-sm-4">
                                <select class="form-control">
                                    <option value="0">任意</option>
                                    <option value="1">导航地图自定(推荐）</option>
                                    <option value="2">最短路径</option>
                                    <option value="3">最少收费(经济）</option>
                                    <option value="4">高速优先（最快）</option>
                                </select>
                            </div>
                            <label class="col-sm-2 control-label" for="mddname">目的地名称</label>
                            <div class="col-sm-4">
                                <input class="form-control" id="mddname" name="mddname" v-model="dhd.name" type="text" placeholder="目的地名称" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div id="dhdmap" style="height:300px;width:100%"></div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" v-on:click="tjdhd">提交</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>
<script src="~/Controllers/AMap/RealTimeMapController.js?r=@Guid.NewGuid()"></script>